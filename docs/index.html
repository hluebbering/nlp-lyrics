<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hannah Luebbering">
<meta name="dcterms.date" content="2023-06-14">

<title>NLP Song Lyrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Spotify API</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">NLP Song Lyrics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Spotify API</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#spotify-api" id="toc-spotify-api" class="nav-link active" data-scroll-target="#spotify-api">Spotify API</a>
  <ul class="collapse">
  <li><a href="#display-spotify-playlists" id="toc-display-spotify-playlists" class="nav-link" data-scroll-target="#display-spotify-playlists">Display Spotify Playlists</a></li>
  <li><a href="#get-tracks-from-playlist" id="toc-get-tracks-from-playlist" class="nav-link" data-scroll-target="#get-tracks-from-playlist">Get Tracks from Playlist</a>
  <ul class="collapse">
  <li><a href="#top-artist-genres" id="toc-top-artist-genres" class="nav-link" data-scroll-target="#top-artist-genres">Top Artist Genres</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#genius-api" id="toc-genius-api" class="nav-link" data-scroll-target="#genius-api">Genius API</a>
  <ul class="collapse">
  <li><a href="#regex-and-profanity-filter" id="toc-regex-and-profanity-filter" class="nav-link" data-scroll-target="#regex-and-profanity-filter">1. Regex and Profanity Filter</a></li>
  <li><a href="#removing-stop-words" id="toc-removing-stop-words" class="nav-link" data-scroll-target="#removing-stop-words">2. Removing Stop Words</a></li>
  <li><a href="#nlp" id="toc-nlp" class="nav-link" data-scroll-target="#nlp">NLP</a></li>
  </ul></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together">Putting it All Together</a>
  <ul class="collapse">
  <li><a href="#visualizing-the-data" id="toc-visualizing-the-data" class="nav-link" data-scroll-target="#visualizing-the-data">Visualizing the Data</a></li>
  <li><a href="#spotify-songs---similarity-search" id="toc-spotify-songs---similarity-search" class="nav-link" data-scroll-target="#spotify-songs---similarity-search">Spotify Songs - Similarity Search</a></li>
  <li><a href="#organized-songs-in-a-playlist" id="toc-organized-songs-in-a-playlist" class="nav-link" data-scroll-target="#organized-songs-in-a-playlist">Organized Songs in a Playlist</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">NLP Song Lyrics</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hannah Luebbering </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 14, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="spotify-api" class="level1 unnumbered">
<h1 class="unnumbered">Spotify API</h1>
<p><strong>Goal.</strong> Using machine learning to predict the mood of music from song lyrics and audio features.</p>
<p>The following project uses Python implementation that extracts and analyzes information about songs in a Spotify playlist using the Spotify Web API. We then use the <code>lyricsgenius</code> package to search for and save the lyrics of specific songs from the Genius lyrics website. We then implement a Python script that contains several functions for cleaning song lyrics and determining the sentiment of the lyrics.</p>
<p>In summary, the code retrieves and cleans song lyrics, removes stopwords and performs lemmatization, and finally determines the sentiment of the lyrics using pre-trained models for sentiment analysis.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> spotipy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotipy.oauth2 <span class="im">import</span> SpotifyClientCredentials</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.core.display <span class="im">import</span> HTML</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>client_id <span class="op">=</span> <span class="st">"xxx"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>client_secret <span class="op">=</span> <span class="st">"xxx"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> spotipy.Spotify(auth_manager<span class="op">=</span>SpotifyClientCredentials(client_id, client_secret))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="display-spotify-playlists" class="level2">
<h2 class="anchored" data-anchor-id="display-spotify-playlists">Display Spotify Playlists</h2>
<p>This code retrieves a selection of Spotify playlists for a specified user. It then creates a dataframe that includes various information about each playlist, including the name, ID, description, thumbnail image, and total track count. The resulting dataframe is then displayed as an HTML table, featuring thumbnail images for each playlist.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> <span class="st">"spotify"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>my_playlists <span class="op">=</span> sp.user_playlists(username)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[&quot;hide_code&quot;,&quot;hide-code&quot;]" data-execution_count="5">
<div class="cell-output cell-output-display" data-execution_count="5">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">thumbnail</th>
<th data-quarto-table-cell-role="th">playlist_name</th>
<th data-quarto-table-cell-role="th">playlist_id</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td><img src="https://i.scdn.co/image/ab67706f000000038aac8628d0ae78c212d69117" class="img-fluid" width="40"></td>
<td>Today's Top Hits</td>
<td>37i9dQZF1DXcBWIGoYBM5M</td>
<td>Post Malone is on top of the Hottest 50!</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td><img src="https://i.scdn.co/image/ab67706f00000003e5382c6955d7aee148ac4e07" class="img-fluid" width="40"></td>
<td>RapCaviar</td>
<td>37i9dQZF1DX0XUsuxWHRQd</td>
<td>New music from Travis Scott, Drake, Central Cee and Offset.</td>
<td>50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td><img src="https://i.scdn.co/image/ab67706f0000000365192685cdbde7815672489b" class="img-fluid" width="40"></td>
<td>Hot Country</td>
<td>37i9dQZF1DX1lVhptIYRda</td>
<td>Today's top country hits. Cover: Lainey Wilson</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td><img src="https://i.scdn.co/image/ab67706f000000038604944b3435cbc8d55f567a" class="img-fluid" width="40"></td>
<td>Viva Latino</td>
<td>37i9dQZF1DX10zKzsJ2jva</td>
<td>Today's top Latin hits, elevando nuestra música. Cover: Quevedo</td>
<td>50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td><img src="https://i.scdn.co/image/ab67706f000000031e194efaed8b2b9f4e0d6445" class="img-fluid" width="40"></td>
<td>New Music Friday</td>
<td>37i9dQZF1DX4JAvHpjipBk</td>
<td>New music from Travis Scott, Post Malone, Offset &amp; Cardi B, Mitski, Calvin Harris &amp; Sam Smith and more!</td>
<td>100</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
<section id="get-tracks-from-playlist" class="level2">
<h2 class="anchored" data-anchor-id="get-tracks-from-playlist">Get Tracks from Playlist</h2>
<p>The given code utilizes Spotify’s API to retrieve information about songs in a Spotify playlist. It collects metadata including track name, album, and release date, as well as track features such as danceability and tempo. Additionally, it acquires data on the popularity and genre of the main artist. The extracted information is then organized and displayed in a pandas DataFrame.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get playlist song features and artist info</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> playlist_features(<span class="bu">id</span>, artist_id, playlist_id):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create Spotify API client variables</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    meta <span class="op">=</span> sp.track(<span class="bu">id</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    audio_features <span class="op">=</span> sp.audio_features(<span class="bu">id</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    artist_info <span class="op">=</span> sp.artist(artist_id)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    playlist_info <span class="op">=</span> sp.playlist(playlist_id)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Metadata</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> meta[<span class="st">'name'</span>]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    track_id <span class="op">=</span> meta[<span class="st">'id'</span>]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    album <span class="op">=</span> meta[<span class="st">'album'</span>][<span class="st">'name'</span>]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    artist <span class="op">=</span> meta[<span class="st">'album'</span>][<span class="st">'artists'</span>][<span class="dv">0</span>][<span class="st">'name'</span>]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    artist_id <span class="op">=</span> meta[<span class="st">'album'</span>][<span class="st">'artists'</span>][<span class="dv">0</span>][<span class="st">'id'</span>]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    release_date <span class="op">=</span> meta[<span class="st">'album'</span>][<span class="st">'release_date'</span>]</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> meta[<span class="st">'duration_ms'</span>]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    popularity <span class="op">=</span> meta[<span class="st">'popularity'</span>]</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Main artist name, popularity, genre</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    artist_pop <span class="op">=</span> artist_info[<span class="st">"popularity"</span>]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    artist_genres <span class="op">=</span> artist_info[<span class="st">"genres"</span>]</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Track features</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    acousticness <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'acousticness'</span>]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    danceability <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'danceability'</span>]</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    energy <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'energy'</span>]</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    instrumentalness <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'instrumentalness'</span>]</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    liveness <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'liveness'</span>]</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    loudness <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'loudness'</span>]</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    speechiness <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'speechiness'</span>]</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    tempo <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'tempo'</span>]</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    valence <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'valence'</span>]</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    key <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'key'</span>]</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    mode <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'mode'</span>]</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    time_signature <span class="op">=</span> audio_features[<span class="dv">0</span>][<span class="st">'time_signature'</span>]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Basic playlist info</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    playlist_name <span class="op">=</span> playlist_info[<span class="st">'name'</span>]</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [name, track_id, album, artist, artist_id, release_date, length, popularity, </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            artist_pop, artist_genres, acousticness, danceability, </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            energy, instrumentalness, liveness, loudness, speechiness, </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            tempo, valence, key, mode, time_signature, playlist_name]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_playlist_tracks(playlist_URI):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    tracks <span class="op">=</span> []</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> sp.playlist_tracks(playlist_URI)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    tracks <span class="op">=</span> results[<span class="st">"items"</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> results[<span class="st">"next"</span>]:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> sp.<span class="bu">next</span>(results)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        tracks.extend(results[<span class="st">"items"</span>])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tracks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Choose a specific playlist to analyze by copying the URL from the Spotify Player interface. Using that link, the following code uses the <code>get_playlist_tracks</code> method to retrieve a list of IDs and corresponding artists for each track from the playlist.</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spotify playlist url</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>playlist_ids <span class="op">=</span> []</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>track_ids <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>artist_uris <span class="op">=</span> []</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract song ids and artists from playlist</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>playlist_URI <span class="op">=</span> <span class="st">"37i9dQZF1DXcBWIGoYBM5M"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> get_playlist_tracks(playlist_URI):</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    track_ids.append(i[<span class="st">"track"</span>][<span class="st">"id"</span>])</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    artist_uris.append(i[<span class="st">"track"</span>][<span class="st">"artists"</span>][<span class="dv">0</span>][<span class="st">"uri"</span>])</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    playlist_ids.append(playlist_URI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code above extracts song and artist information from a Spotify playlist identified by its URI. The extracted data includes track IDs, artist URIs, and playlist IDs.</p>
<p>The following code loops through each track ID in the playlist and extracts additional song information by calling the function we created above. From there, we can create a pandas data frame by passing in the extracted information and giving the column header names we want.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over track ids</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>all_tracks <span class="op">=</span> [</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    playlist_features(track_ids[i], artist_uris[i], playlist_ids[i])</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(track_ids))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[&quot;hide-code&quot;]" data-execution_count="112">
<div class="cell-output cell-output-display" data-execution_count="112">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">artist</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">popularity</th>
<th data-quarto-table-cell-role="th">artist_pop</th>
<th data-quarto-table-cell-role="th">artist_genres</th>
<th data-quarto-table-cell-role="th">acousticness</th>
<th data-quarto-table-cell-role="th">danceability</th>
<th data-quarto-table-cell-role="th">energy</th>
<th data-quarto-table-cell-role="th">instrumentalness</th>
<th data-quarto-table-cell-role="th">liveness</th>
<th data-quarto-table-cell-role="th">loudness</th>
<th data-quarto-table-cell-role="th">speechiness</th>
<th data-quarto-table-cell-role="th">tempo</th>
<th data-quarto-table-cell-role="th">valence</th>
<th data-quarto-table-cell-role="th">playlist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>What Was I Made For? [From The Motion Picture "Barbie"]</td>
<td>Billie Eilish</td>
<td>2023-07-13</td>
<td>84</td>
<td>86</td>
<td>[art pop, electropop, pop]</td>
<td>0.9590</td>
<td>0.444</td>
<td>0.0911</td>
<td>0.000001</td>
<td>0.098</td>
<td>-17.665</td>
<td>0.0307</td>
<td>78.403</td>
<td>0.142</td>
<td>Today's Top Hits</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>vampire</td>
<td>Olivia Rodrigo</td>
<td>2023-06-30</td>
<td>98</td>
<td>84</td>
<td>[pop]</td>
<td>0.1690</td>
<td>0.511</td>
<td>0.5320</td>
<td>0.000000</td>
<td>0.311</td>
<td>-5.745</td>
<td>0.0560</td>
<td>137.827</td>
<td>0.322</td>
<td>Today's Top Hits</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cruel Summer</td>
<td>Taylor Swift</td>
<td>2019-08-23</td>
<td>99</td>
<td>100</td>
<td>[pop]</td>
<td>0.1170</td>
<td>0.552</td>
<td>0.7020</td>
<td>0.000021</td>
<td>0.105</td>
<td>-5.707</td>
<td>0.1570</td>
<td>169.994</td>
<td>0.564</td>
<td>Today's Top Hits</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Popular (with Playboi Carti &amp; Madonna) - Music from the HBO Original Series</td>
<td>The Weeknd</td>
<td>2023-06-02</td>
<td>91</td>
<td>93</td>
<td>[canadian contemporary r&amp;b, canadian pop, pop]</td>
<td>0.0569</td>
<td>0.855</td>
<td>0.6780</td>
<td>0.000037</td>
<td>0.412</td>
<td>-6.276</td>
<td>0.1890</td>
<td>99.029</td>
<td>0.852</td>
<td>Today's Top Hits</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Dance The Night (From Barbie The Album)</td>
<td>Dua Lipa</td>
<td>2023-05-25</td>
<td>94</td>
<td>85</td>
<td>[dance pop, pop, uk pop]</td>
<td>0.0207</td>
<td>0.671</td>
<td>0.8450</td>
<td>0.000000</td>
<td>0.329</td>
<td>-4.930</td>
<td>0.0480</td>
<td>110.056</td>
<td>0.775</td>
<td>Today's Top Hits</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>WHERE SHE GOES</td>
<td>Bad Bunny</td>
<td>2023-05-18</td>
<td>100</td>
<td>94</td>
<td>[reggaeton, trap latino, urbano latino]</td>
<td>0.1430</td>
<td>0.652</td>
<td>0.8000</td>
<td>0.629000</td>
<td>0.112</td>
<td>-4.019</td>
<td>0.0614</td>
<td>143.978</td>
<td>0.234</td>
<td>Today's Top Hits</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Barbie World (with Aqua) [From Barbie The Album]</td>
<td>Nicki Minaj</td>
<td>2023-06-23</td>
<td>91</td>
<td>85</td>
<td>[hip pop, pop, queens hip hop, rap]</td>
<td>0.5190</td>
<td>0.770</td>
<td>0.5800</td>
<td>0.000127</td>
<td>0.233</td>
<td>-8.393</td>
<td>0.2470</td>
<td>144.072</td>
<td>0.753</td>
<td>Today's Top Hits</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Kill Bill</td>
<td>SZA</td>
<td>2022-12-08</td>
<td>95</td>
<td>87</td>
<td>[pop, r&amp;b, rap]</td>
<td>0.0521</td>
<td>0.644</td>
<td>0.7350</td>
<td>0.144000</td>
<td>0.161</td>
<td>-5.747</td>
<td>0.0391</td>
<td>88.980</td>
<td>0.418</td>
<td>Today's Top Hits</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>As It Was</td>
<td>Harry Styles</td>
<td>2022-03-31</td>
<td>93</td>
<td>86</td>
<td>[pop]</td>
<td>0.3420</td>
<td>0.520</td>
<td>0.7310</td>
<td>0.001010</td>
<td>0.311</td>
<td>-5.338</td>
<td>0.0557</td>
<td>173.930</td>
<td>0.662</td>
<td>Today's Top Hits</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Super Shy</td>
<td>NewJeans</td>
<td>2023-07-07</td>
<td>91</td>
<td>80</td>
<td>[k-pop, k-pop girl group]</td>
<td>0.1800</td>
<td>0.776</td>
<td>0.8170</td>
<td>0.000034</td>
<td>0.146</td>
<td>-6.018</td>
<td>0.0748</td>
<td>149.921</td>
<td>0.515</td>
<td>Today's Top Hits</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="top-artist-genres" class="level3">
<h3 class="anchored" data-anchor-id="top-artist-genres">Top Artist Genres</h3>
<p>The code below creates a dictionary of artist genres and their frequency, and then converts it into a dataframe for sorting by frequency. This code is counting how many times each genre appears in a list called <code>artist_genres</code>. It does this by creating a dictionary called <code>genres_dict</code>. It then puts the results in a DataFrame called <code>df_genres</code>, which shows the genres and how many times they appear.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>genres_dict <span class="op">=</span> {}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.artist_genres:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ii <span class="kw">in</span> x:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ii <span class="kw">in</span> genres_dict:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            genres_dict[ii] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            genres_dict[ii] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(genres_dict)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Dictionary to Dataframe</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>df_genres <span class="op">=</span> pd.DataFrame(genres_dict.items(), columns<span class="op">=</span>[<span class="st">'Genre'</span>, <span class="st">'Freq'</span>]).sort_values(<span class="st">'Freq'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>df_genres <span class="op">=</span> df_genres.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'art pop': 2, 'electropop': 1, 'pop': 24, 'canadian contemporary r&amp;b': 2, 'canadian pop': 2, 'dance pop': 5, 'uk pop': 3, 'reggaeton': 3, 'trap latino': 4, 'urbano latino': 4, 'hip pop': 1, 'queens hip hop': 1, 'rap': 8, 'r&amp;b': 3, 'k-pop': 2, 'k-pop girl group': 2, 'afrobeats': 2, 'nigerian pop': 1, 'hip hop': 3, 'atl hip hop': 1, 'melodic rap': 2, 'trap': 2, 'dfw rap': 1, 'big room': 2, 'edm': 3, 'pop dance': 2, 'bedroom pop': 2, 'rap canario': 1, 'chicago drill': 1, 'chicago rap': 1, 'drill': 1, 'gen z singer-songwriter': 2, 'singer-songwriter pop': 3, 'pop reggaeton': 1, 'colombian pop': 1, 'contemporary country': 2, 'country': 1, 'piano rock': 1, 'australian pop': 1, 'viral pop': 1, 'alternative r&amp;b': 1, 'modern indie pop': 1, 'pov: indie': 2, 'corrido': 1, 'corridos tumbados': 1, 'sad sierreno': 1, 'sierreno': 1, 'bedroom r&amp;b': 1, 'alternative pop rock': 1, 'electro house': 1, 'house': 1, 'progressive house': 1, 'uk dance': 1, 'electra': 1, 'float house': 1, 'uk hip hop': 1}</code></pre>
</div>
</div>
<div class="cell" data-tags="[&quot;hide-code&quot;]" data-execution_count="63">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="genius-api" class="level1">
<h1>Genius API</h1>
<p>The following is a Python script that contains several functions for cleaning song lyrics and determining the sentiment of the lyrics. First, we import <code>lyricsgenius</code> and <code>BeautifulSoup</code> libraries. The genius variable uses the lyricsgenius API to search for the lyrics of any song, for example “Too Many Nights” by Metro Boomin. The commented code at the end saves the lyrics.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lyricsgenius</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>genius <span class="op">=</span> lyricsgenius.Genius(<span class="st">"epFCxujgBe-Y6WrkZedI8kerKxiCpR6Rh0DAHYNlKDf9B4H1nXTdZIkj7krNUHVV"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>song <span class="op">=</span> genius.search_song(<span class="st">"Too Many Nights"</span>, <span class="st">"Metro Boomin"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># song.save_lyrics()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Searching for "No Good" by Juice WRLD...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Done.</code></pre>
</div>
</div>
<section id="regex-and-profanity-filter" class="level3">
<h3 class="anchored" data-anchor-id="regex-and-profanity-filter">1. Regex and Profanity Filter</h3>
<p>The following function essentially takes a song name and artist, searches for the lyrics of the song, cleans the lyrics by removing profanity and certain characters/patterns, and returns a list of cleaned lyrics with non-ASCII characters removed.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> profanity <span class="im">import</span> profanity</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> better_profanity <span class="im">import</span> profanity <span class="im">as</span> profanity2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_song_lyrics(song_name, song_artist):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    song_genius <span class="op">=</span> genius.search_song(song_name, song_artist)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> song_genius.lyrics.partition(<span class="st">'Lyrics'</span>)[<span class="dv">2</span>].lower()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> profanity.censor(clean_lyrics) <span class="co"># censored_text</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> re.sub(<span class="vs">r"[,\(\)\?\!\.\$\#\@\%]"</span>, <span class="st">""</span>, clean_lyrics)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> re.sub(<span class="vs">r"[\[].*?[\]]"</span>, <span class="st">""</span>, clean_lyrics)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> re.sub(<span class="vs">r"\d+embed"</span>, <span class="st">""</span>, clean_lyrics)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> re.sub(<span class="vs">r'\"'</span>, <span class="st">''</span>, clean_lyrics)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> profanity2.censor(clean_lyrics) <span class="co"># censored_text</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    clean_lyrics <span class="op">=</span> re.sub(<span class="vs">r"[\*]"</span>, <span class="st">""</span>, clean_lyrics)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    clean_lyrics_decode <span class="op">=</span> []</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> (clean_lyrics.split()):</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">#encode() method</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        strencode <span class="op">=</span> i.encode(<span class="st">"ascii"</span>, <span class="st">"ignore"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#decode() method</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        strdecode <span class="op">=</span> strencode.decode()</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        clean_lyrics_decode.append(strdecode)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> clean_lyrics_decode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="removing-stop-words" class="level3">
<h3 class="anchored" data-anchor-id="removing-stop-words">2. Removing Stop Words</h3>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#import spacy</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#import nltk</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import gensim</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem <span class="im">import</span> WordNetLemmatizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_stopwords_lyrics(clean_lyrics_decode):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    stopword <span class="op">=</span> stopwords.words(<span class="st">'english'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    stopword.extend([<span class="st">"i'm"</span>, <span class="st">"i'll"</span>, <span class="st">"'ll"</span>, <span class="st">"i'ma"</span>])</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    removing_stopwords <span class="op">=</span> [word <span class="cf">for</span> word <span class="kw">in</span> clean_lyrics_decode <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stopword]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    wnl <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [wnl.lemmatize(word) <span class="cf">for</span> word <span class="kw">in</span> removing_stopwords] <span class="co"># lemmatized_word</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="nlp" class="level2">
<h2 class="anchored" data-anchor-id="nlp">NLP</h2>
<p>Using pipeline class to make predictions from models available in the Hub</p>
<div class="cell" data-tags="[&quot;hide-output&quot;,&quot;hide-warning&quot;,&quot;hide-message&quot;]" data-execution_count="71">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> transformers</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#import tensorflow as tf</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">## python -m pip install "tensorflow&lt;2.11"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># python -m pip install "protobuf&lt;3.2"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> pipeline(<span class="st">"text-classification"</span>,model<span class="op">=</span><span class="st">'bhadresh-savani/distilbert-base-uncased-emotion'</span>, return_all_scores<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>classifier2 <span class="op">=</span> pipeline(<span class="st">"text-classification"</span>,model<span class="op">=</span><span class="st">'cardiffnlp/twitter-roberta-base-sentiment'</span>, return_all_scores<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>classifier3 <span class="op">=</span> pipeline(<span class="st">"sentiment-analysis"</span>, return_all_scores<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Distilbert-base-uncased-emotion is a model fine-tuned for detecting emotions in texts, including sadness, joy, love, anger, fear and surprise</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_lyric_sentiment(cleaned_lyrics):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    song_score <span class="op">=</span> {}</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">' '</span>.join(cleaned_lyrics)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classifier = pipeline("text-classification",model='bhadresh-savani/distilbert-base-uncased-emotion', return_all_scores=True)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> classifier(x, truncation <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> prediction[<span class="dv">0</span>]:</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        song_score[j[<span class="st">'label'</span>]] <span class="op">=</span> j[<span class="st">'score'</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#classifier2 = pipeline("text-classification",model='cardiffnlp/twitter-roberta-base-sentiment', return_all_scores=True)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    prediction2 <span class="op">=</span> classifier2(x, truncation<span class="op">=</span><span class="va">True</span>, max_length<span class="op">=</span><span class="dv">512</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> prediction2[<span class="dv">0</span>]:</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        song_score[k[<span class="st">'label'</span>]] <span class="op">=</span> k[<span class="st">'score'</span>]</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#classifier3 = pipeline("sentiment-analysis", return_all_scores=True)</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    prediction3 <span class="op">=</span> classifier3(x, truncation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k3 <span class="kw">in</span> prediction3[<span class="dv">0</span>]:</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        song_score[k3[<span class="st">'label'</span>]] <span class="op">=</span> k3[<span class="st">'score'</span>]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> song_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How to handle sequences longer than 512 tokens Exception encountered when calling layer ‘embeddings’</p>
<hr>
</section>
</section>
<section id="putting-it-all-together" class="level1">
<h1>Putting it All Together</h1>
<p>Overall, this code analyzes song lyrics and collects information about each song. It goes through a list of songs and their artists, cleans the lyrics, and removes unnecessary words. Then, it counts the frequency of each word in the lyrics.</p>
<p>It also calculates a sentiment score for each song based on the lyrics. The sentiment score tells us if the song lyrics are positive, negative, or neutral. It collects information about the song and the artist, like the release date, length, popularity, and genre. Finally, it adds all this information to a list.</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lyrics_dict <span class="op">=</span> {}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dict_ls <span class="op">=</span> []</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df)):</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    song_name <span class="op">=</span> df[<span class="st">'name'</span>][i].partition(<span class="st">' ('</span>)[<span class="dv">0</span>]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    artist_name <span class="op">=</span> df[<span class="st">'artist'</span>][i]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    track_lyrics <span class="op">=</span> clean_song_lyrics(song_name, artist_name)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    track_lyrics <span class="op">=</span> remove_stopwords_lyrics(track_lyrics)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> (track_lyrics):</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="kw">in</span> lyrics_dict:</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            lyrics_dict[k] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            lyrics_dict[k] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    sent_score <span class="op">=</span> get_lyric_sentiment(track_lyrics)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'track_name'</span>] <span class="op">=</span> song_name</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'artist_name'</span>] <span class="op">=</span> artist_name</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'release_date'</span>] <span class="op">=</span> df[<span class="st">'release_date'</span>][i]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'length'</span>] <span class="op">=</span> df[<span class="st">'length'</span>][i]</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'popularity'</span>] <span class="op">=</span> df[<span class="st">'popularity'</span>][i]</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'artist_pop'</span>] <span class="op">=</span> df[<span class="st">'artist_pop'</span>][i]</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'artist_genres'</span>] <span class="op">=</span> df[<span class="st">'artist_genres'</span>][i]</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'acousticness'</span>] <span class="op">=</span> df[<span class="st">'acousticness'</span>][i]</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'danceability'</span>] <span class="op">=</span> df[<span class="st">'danceability'</span>][i]</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'energy'</span>] <span class="op">=</span> df[<span class="st">'energy'</span>][i]</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'instrumentalness'</span>] <span class="op">=</span> df[<span class="st">'instrumentalness'</span>][i]</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'liveness'</span>] <span class="op">=</span> df[<span class="st">'liveness'</span>][i]</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'loudness'</span>] <span class="op">=</span> df[<span class="st">'loudness'</span>][i]</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'speechiness'</span>] <span class="op">=</span> df[<span class="st">'speechiness'</span>][i]</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'tempo'</span>] <span class="op">=</span> df[<span class="st">'tempo'</span>][i]</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    sent_score[<span class="st">'valence'</span>] <span class="op">=</span> df[<span class="st">'valence'</span>][i]</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    dict_ls.append(sent_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Searching for "What Was I Made For? [From The Motion Picture "Barbie"]" by Billie Eilish...
Done.
Searching for "vampire" by Olivia Rodrigo...
Done.
Searching for "Cruel Summer" by Taylor Swift...
Done.
Searching for "Popular" by The Weeknd...
Done.
Searching for "Dance The Night" by Dua Lipa...
Done.
Searching for "WHERE SHE GOES" by Bad Bunny...
Done.
Searching for "Barbie World" by Nicki Minaj...
Done.
Searching for "Kill Bill" by SZA...
Done.
Searching for "As It Was" by Harry Styles...
Done.
Searching for "Super Shy" by NewJeans...
Done.
Searching for "Flowers" by Miley Cyrus...
Done.
Searching for "Calm Down" by Rema...
Done.
Searching for "Calling" by Metro Boomin...
Done.
Searching for "fukumean" by Gunna...
Done.
Searching for "Attention" by Doja Cat...
Done.
Searching for "Seven" by Jung Kook...
Done.
Searching for "Cupid - Twin Ver." by FIFTY FIFTY...
Done.
Searching for "Chemical" by Post Malone...
Done.
Searching for "People" by Libianca...
Done.
Searching for "LALA" by Myke Towers...
Done.
Searching for "Die For You - Remix" by The Weeknd...
Done.
Searching for "Baby Don't Hurt Me" by David Guetta...
Done.
Searching for "Boy's a Liar Pt. 2" by PinkPantheress...
Done.
Searching for "Columbia" by Quevedo...
Done.
Searching for "All My Life" by Lil Durk...
Done.
Searching for "Daylight" by David Kushner...
Done.
Searching for "Creepin'" by Metro Boomin...
Done.
Searching for "MOJABI GHOST" by Tainy...
Done.
Searching for "Moonlight" by Kali Uchis...
Done.
Searching for "Snooze" by SZA...
Done.
Searching for "Fast Car" by Luke Combs...
Done.
Searching for "Karma" by Taylor Swift...
Done.
Searching for "I Ain't Worried" by OneRepublic...
Done.
Searching for "Rush" by Troye Sivan...
Done.
Searching for "What It Is" by Doechii...
Done.
Searching for "I'm Good" by David Guetta...
Done.
Searching for "Until I Found You" by Stephen Sanchez...
Done.
Searching for "Eyes Closed" by Ed Sheeran...
Done.
Searching for "golden hour" by JVKE...
Done.
Searching for "Ella Baila Sola" by Eslabon Armado...
Done.
Searching for "Say Yes To Heaven" by Lana Del Rey...
Done.
Searching for "CUFF IT" by Beyoncé...
Done.
Searching for "Here With Me" by d4vd...
Done.
Searching for "Mona Lisa" by Dominic Fike...
Done.
Searching for "Nonsense" by Sabrina Carpenter...
Done.
Searching for "Miracle" by Calvin Harris...
Done.
Searching for "(It Goes Like) Nanana - Edit" by Peggy Gou...
Done.
Searching for "Sprinter" by Dave...
Done.
Searching for "Last Night" by Morgan Wallen...
Done.
Searching for "Unholy" by Sam Smith...
Done.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> pd.DataFrame(dict_ls)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> df_final[[<span class="st">'track_name'</span>, <span class="st">'artist_name'</span>, <span class="st">'release_date'</span>, <span class="st">'length'</span>, <span class="st">'popularity'</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">'artist_pop'</span>, <span class="st">'artist_genres'</span>, <span class="st">'acousticness'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">'instrumentalness'</span>, <span class="st">'liveness'</span>, <span class="st">'loudness'</span>, <span class="st">'speechiness'</span>, <span class="st">'tempo'</span>, <span class="st">'valence'</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">'sadness'</span>, <span class="st">'joy'</span>, <span class="st">'love'</span>, <span class="st">'anger'</span>, <span class="st">'fear'</span>, <span class="st">'surprise'</span>, <span class="st">'LABEL_0'</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">'LABEL_1'</span>, <span class="st">'LABEL_2'</span>, <span class="st">'NEGATIVE'</span>, <span class="st">'POSITIVE'</span>]]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df_final.to_csv('top_songs_us.csv', index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[&quot;hide-code&quot;]" data-execution_count="75">
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">track_name</th>
<th data-quarto-table-cell-role="th">artist_name</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">length</th>
<th data-quarto-table-cell-role="th">popularity</th>
<th data-quarto-table-cell-role="th">artist_pop</th>
<th data-quarto-table-cell-role="th">artist_genres</th>
<th data-quarto-table-cell-role="th">acousticness</th>
<th data-quarto-table-cell-role="th">danceability</th>
<th data-quarto-table-cell-role="th">energy</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">joy</th>
<th data-quarto-table-cell-role="th">love</th>
<th data-quarto-table-cell-role="th">anger</th>
<th data-quarto-table-cell-role="th">fear</th>
<th data-quarto-table-cell-role="th">surprise</th>
<th data-quarto-table-cell-role="th">LABEL_0</th>
<th data-quarto-table-cell-role="th">LABEL_1</th>
<th data-quarto-table-cell-role="th">LABEL_2</th>
<th data-quarto-table-cell-role="th">NEGATIVE</th>
<th data-quarto-table-cell-role="th">POSITIVE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>What Was I Made For? [From The Motion Picture "Barbie"]</td>
<td>Billie Eilish</td>
<td>2023-07-13</td>
<td>222369</td>
<td>84</td>
<td>86</td>
<td>[art pop, electropop, pop]</td>
<td>0.959</td>
<td>0.444</td>
<td>0.0911</td>
<td>...</td>
<td>0.197081</td>
<td>0.009966</td>
<td>0.345436</td>
<td>0.179204</td>
<td>0.008392</td>
<td>0.095024</td>
<td>0.854509</td>
<td>0.050466</td>
<td>0.971982</td>
<td>0.028018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>vampire</td>
<td>Olivia Rodrigo</td>
<td>2023-06-30</td>
<td>219724</td>
<td>98</td>
<td>84</td>
<td>[pop]</td>
<td>0.169</td>
<td>0.511</td>
<td>0.5320</td>
<td>...</td>
<td>0.993057</td>
<td>0.000612</td>
<td>0.001648</td>
<td>0.001187</td>
<td>0.000837</td>
<td>0.727187</td>
<td>0.240037</td>
<td>0.032776</td>
<td>0.998202</td>
<td>0.001798</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cruel Summer</td>
<td>Taylor Swift</td>
<td>2019-08-23</td>
<td>178426</td>
<td>99</td>
<td>100</td>
<td>[pop]</td>
<td>0.117</td>
<td>0.552</td>
<td>0.7020</td>
<td>...</td>
<td>0.241193</td>
<td>0.017412</td>
<td>0.405512</td>
<td>0.024407</td>
<td>0.003616</td>
<td>0.287019</td>
<td>0.607944</td>
<td>0.105037</td>
<td>0.994126</td>
<td>0.005874</td>
</tr>
</tbody>
</table>

<p>3 rows × 27 columns</p>
</div>
</div>
</div>
<p>In summary, the code retrieves and cleans song lyrics, removes stopwords and performs lemmatization, and finally determines the sentiment of the lyrics using pre-trained models for sentiment analysis.</p>
<section id="visualizing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-data">Visualizing the Data</h3>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Set Default Plot Chart Style Configurations</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>, <span class="va">None</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"poster"</span>, font_scale<span class="op">=</span><span class="fl">.5</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="fl">0.6</span>})</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>sns.set_style({<span class="st">'font.family'</span>: <span class="st">'Roboto'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig_hist <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">5</span>), dpi <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Figure 1. Distribution of Song Popularity"</span>, weight<span class="op">=</span><span class="st">'heavy'</span>,y <span class="op">=</span><span class="fl">1.1</span>, x<span class="op">=</span><span class="fl">0.2</span>).set_fontsize(<span class="st">'16'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> sns.histplot(data<span class="op">=</span>df_final, x<span class="op">=</span><span class="st">"popularity"</span>, color<span class="op">=</span><span class="st">"#F9C762"</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>,bins<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>z.spines[<span class="st">'bottom'</span>].set_color(<span class="st">'#DDDDDD'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>z.yaxis.grid(<span class="va">True</span>, color<span class="op">=</span><span class="st">'#EEEEEE'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>z.xaxis.grid(<span class="va">False</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Popularity"</span>, size<span class="op">=</span><span class="dv">17</span>, weight<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Frequency"</span>, size<span class="op">=</span><span class="dv">17</span>, weight<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig("hold_times_dist.png", format="png", dpi=1200)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[&quot;hide-code&quot;]" data-execution_count="78">
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<section id="twitter-roberta-base-for-sentiment-analysis" class="level4">
<h4 class="anchored" data-anchor-id="twitter-roberta-base-for-sentiment-analysis">Twitter-roBERTa-base for Sentiment Analysis</h4>
<p>This is a roBERTa-base model trained on ~58M tweets and finetuned for sentiment analysis with the TweetEval benchmark. This model is suitable for English (for a similar multilingual model, see XLM-T).</p>
<p>Reference Paper: TweetEval (Findings of EMNLP 2020). Git Repo: Tweeteval official repository. Labels: 0 -&gt; Negative; 1 -&gt; Neutral; 2 -&gt; Positive</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Figure 2. roBERTa-base Model Labels Distribution"</span>, weight<span class="op">=</span><span class="st">'heavy'</span>,y <span class="op">=</span><span class="fl">0.99</span>, x<span class="op">=</span><span class="fl">0.16</span>).set_fontsize(<span class="st">'18'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df_final, x<span class="op">=</span>df_final[df_final[<span class="st">'LABEL_0'</span>].notnull()][<span class="st">'LABEL_0'</span>], color<span class="op">=</span><span class="st">"#e794bb"</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>], bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">"Negative"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df_final, x<span class="op">=</span>df_final[df_final[<span class="st">'LABEL_1'</span>].notnull()][<span class="st">'LABEL_1'</span>], color<span class="op">=</span><span class="st">"#ba328b"</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>], bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">"Neutral"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df_final, x<span class="op">=</span>df_final[df_final[<span class="st">'LABEL_2'</span>].notnull()][<span class="st">'LABEL_2'</span>], color<span class="op">=</span><span class="st">"teal"</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>], bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="st">"Positive"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig("_static/images/brand_dist.png", format="png", dpi=1200)</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="correlations-matrix" class="level4">
<h4 class="anchored" data-anchor-id="correlations-matrix">Correlations Matrix</h4>
<p>Next, we find the Pearson correlations matrix by using the pandas command <code>df.corr()</code>. We then plot the correlation matrix with the seaborn heatmap.</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>track_sentiment_df <span class="op">=</span> df_final[[<span class="st">'track_name'</span>, <span class="st">'artist_name'</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'acousticness'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">'instrumentalness'</span>, <span class="st">'loudness'</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">'speechiness'</span>, <span class="st">'tempo'</span>, <span class="st">'valence'</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">'sadness'</span>, <span class="st">'joy'</span>, <span class="st">'love'</span>, <span class="st">'anger'</span>, <span class="st">'fear'</span>, <span class="st">'surprise'</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">'LABEL_0'</span>, <span class="st">'LABEL_1'</span>, <span class="st">'LABEL_2'</span>, <span class="st">'NEGATIVE'</span>, <span class="st">'POSITIVE'</span>]]</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the pearson correlations matrix</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> track_sentiment_df.corr(method <span class="op">=</span> <span class="st">'pearson'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>), dpi <span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.heatmap(corr,annot<span class="op">=</span><span class="va">True</span>,fmt<span class="op">=</span><span class="st">".2f"</span>, linewidth<span class="op">=</span><span class="fl">.5</span>, annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">8</span>}, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">.52</span>})</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>g.set_xticklabels(g.get_xmajorticklabels(), fontsize <span class="op">=</span> <span class="dv">9</span>,family<span class="op">=</span><span class="st">'Roboto'</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>g.set_yticklabels(g.get_ymajorticklabels(), fontsize <span class="op">=</span> <span class="dv">9</span>,family<span class="op">=</span><span class="st">'Roboto'</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Sentiment Analysis Model Labels Correlation Matrix'</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('heatmap.png')              </span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatterplot. alpha controls the opacity and s controls the size.</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.scatterplot(x<span class="op">=</span>track_sentiment_df[<span class="st">'energy'</span>]<span class="op">**</span><span class="fl">0.5</span>, y<span class="op">=</span>track_sentiment_df[<span class="st">'fear'</span>]<span class="op">**</span><span class="fl">0.5</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>               size<span class="op">=</span>track_sentiment_df[<span class="st">'LABEL_1'</span>]<span class="op">*</span><span class="dv">10</span>, hue<span class="op">=</span>track_sentiment_df[<span class="st">'valence'</span>],</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>               sizes<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">1600</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>               palette<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#For each point, we add a text inside the bubble</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,track_sentiment_df.shape[<span class="dv">0</span>]):</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>     ax.text(track_sentiment_df.energy[line]<span class="op">**</span><span class="fl">0.5</span>, track_sentiment_df.fear[line]<span class="op">**</span><span class="fl">0.5</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>             <span class="bu">round</span>(track_sentiment_df.energy[line], <span class="dv">2</span>), </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>             horizontalalignment<span class="op">=</span><span class="st">'center'</span>, size<span class="op">=</span><span class="st">'medium'</span>, color<span class="op">=</span><span class="st">'black'</span>, weight<span class="op">=</span><span class="st">'semibold'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">'Fear x Energy Scatterplot'</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.title(title)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig(title, dpi=400)</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> sns.scatterplot(x <span class="op">=</span> track_sentiment_df[<span class="st">'energy'</span>]<span class="op">**</span><span class="fl">0.25</span>, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                       y <span class="op">=</span> track_sentiment_df[<span class="st">'fear'</span>]<span class="op">**</span><span class="fl">0.25</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                       hue <span class="op">=</span> track_sentiment_df[<span class="st">'valence'</span>],</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                       size <span class="op">=</span> track_sentiment_df[<span class="st">'LABEL_1'</span>],</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                       sizes <span class="op">=</span> (<span class="dv">50</span>, <span class="dv">200</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                       size_order <span class="op">=</span> track_sentiment_df[<span class="st">'LABEL_1'</span>],</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                       palette <span class="op">=</span> <span class="st">'viridis'</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plot.set_title(<span class="st">'Fear vs. Energy'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>Text(0.5, 1.0, 'Fear vs. Energy')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-34-output-2.png" class="img-fluid"></p>
</div>
</div>
<hr>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>X_SMALL <span class="op">=</span> df_final[[<span class="st">'acousticness'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'speechiness'</span>, <span class="st">'tempo'</span>, <span class="st">'valence'</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'sadness'</span>, <span class="st">'joy'</span>, <span class="st">'love'</span>, <span class="st">'anger'</span>, <span class="st">'fear'</span>, <span class="st">'surprise'</span>, <span class="st">'track_name'</span>, <span class="st">'NEGATIVE'</span>, <span class="st">'POSITIVE'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bioinfokit.visuz <span class="im">import</span> cluster</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>X_i <span class="op">=</span> X_SMALL.iloc[:,<span class="dv">0</span>:<span class="dv">12</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> X_SMALL[<span class="st">'track_name'</span>].to_numpy()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>X_st <span class="op">=</span>  StandardScaler().fit_transform(X_i)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>pca_out <span class="op">=</span> PCA().fit(X_st)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># component loadings</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>loadings <span class="op">=</span> pca_out.components_</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#loadings</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># get eigenvalues (variance explained by each PC)  </span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>pca_out.explained_variance_</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># get biplot</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>pca_scores <span class="op">=</span> PCA().fit_transform(X_st)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>cluster.biplot(cscore<span class="op">=</span>pca_scores, loadings<span class="op">=</span>loadings, labels<span class="op">=</span>X_i.columns.values, </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>               var1<span class="op">=</span><span class="bu">round</span>(pca_out.explained_variance_ratio_[<span class="dv">0</span>]<span class="op">*</span><span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>               var2<span class="op">=</span><span class="bu">round</span>(pca_out.explained_variance_ratio_[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="co">#colorlist=target,</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>               show<span class="op">=</span><span class="va">True</span>,dim<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>),dotsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pca = PCA()</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#X_i = X_SMALL.iloc[:,0:12]</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#X_st =  StandardScaler().fit_transform(X_i)</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#pca_out = PCA().fit(X_st)</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#data_pca = pca.fit_transform(X_SMALL)</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># data_pca[:12]</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>pca_scores <span class="op">=</span> PCA().fit_transform(X_st)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># pca_scores</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>df_pca <span class="op">=</span> pd.DataFrame(pca_scores)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>df_pca.head()</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>cols_pca <span class="op">=</span> [<span class="ss">f'PC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, pca_out.n_components_<span class="op">+</span><span class="dv">1</span>)]</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>cols_pca</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>df_pca <span class="op">=</span> pd.DataFrame(pca_scores, columns<span class="op">=</span>cols_pca, index<span class="op">=</span>X_i.index)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>df_pca.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
<th data-quarto-table-cell-role="th">PC6</th>
<th data-quarto-table-cell-role="th">PC7</th>
<th data-quarto-table-cell-role="th">PC8</th>
<th data-quarto-table-cell-role="th">PC9</th>
<th data-quarto-table-cell-role="th">PC10</th>
<th data-quarto-table-cell-role="th">PC11</th>
<th data-quarto-table-cell-role="th">PC12</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.270466</td>
<td>0.948505</td>
<td>0.355184</td>
<td>0.899354</td>
<td>-1.575176</td>
<td>0.187153</td>
<td>-0.694101</td>
<td>0.246583</td>
<td>-0.259509</td>
<td>0.387764</td>
<td>-0.552148</td>
<td>-2.119118e-08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.868476</td>
<td>0.136365</td>
<td>-1.759115</td>
<td>-0.582333</td>
<td>0.832087</td>
<td>-0.285042</td>
<td>0.571442</td>
<td>-0.345819</td>
<td>-0.837761</td>
<td>0.658721</td>
<td>-0.620495</td>
<td>1.514414e-07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-0.340464</td>
<td>0.211398</td>
<td>0.746624</td>
<td>0.272780</td>
<td>1.084102</td>
<td>-2.222116</td>
<td>0.174974</td>
<td>0.812164</td>
<td>-0.097380</td>
<td>0.662247</td>
<td>0.090877</td>
<td>-1.242305e-07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You can see the following array, where every element represents the amount of variability explained by every component.</p>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pca_out.explained_variance_ratio_)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'----'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pca_out.explained_variance_ratio_.cumsum())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[2.00390189e-01 1.70288991e-01 1.34383910e-01 1.02941653e-01
 9.50028960e-02 8.51572329e-02 6.81063737e-02 5.82327024e-02
 4.89924478e-02 2.36001092e-02 1.29034951e-02 5.87961257e-16]
----
[0.20039019 0.37067918 0.50506309 0.60800474 0.70300764 0.78816487
 0.85627125 0.91450395 0.9634964  0.9870965  1.         1.        ]</code></pre>
</div>
</div>
<p>Relationship between Original Variables &amp; Components Loading Vectors The Principal Components are produced by a mathematical equation, which is composed of the following weights:</p>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_weights <span class="op">=</span> pd.DataFrame(pca_out.components_.T, columns<span class="op">=</span>df_pca.columns, index<span class="op">=</span>X_i.columns)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
<th data-quarto-table-cell-role="th">PC6</th>
<th data-quarto-table-cell-role="th">PC7</th>
<th data-quarto-table-cell-role="th">PC8</th>
<th data-quarto-table-cell-role="th">PC9</th>
<th data-quarto-table-cell-role="th">PC10</th>
<th data-quarto-table-cell-role="th">PC11</th>
<th data-quarto-table-cell-role="th">PC12</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">acousticness</td>
<td>0.468724</td>
<td>0.101178</td>
<td>-0.154943</td>
<td>0.095117</td>
<td>-0.245359</td>
<td>-0.120015</td>
<td>-0.536767</td>
<td>-0.115434</td>
<td>0.070889</td>
<td>-0.338117</td>
<td>0.491538</td>
<td>-1.295545e-09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">danceability</td>
<td>-0.426649</td>
<td>0.208069</td>
<td>0.332417</td>
<td>-0.063468</td>
<td>-0.091243</td>
<td>0.299193</td>
<td>-0.089844</td>
<td>-0.259745</td>
<td>0.015869</td>
<td>-0.686241</td>
<td>-0.124855</td>
<td>9.798790e-09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">energy</td>
<td>-0.494327</td>
<td>-0.300872</td>
<td>-0.156752</td>
<td>0.035209</td>
<td>-0.027445</td>
<td>-0.041468</td>
<td>0.264895</td>
<td>0.231243</td>
<td>0.131833</td>
<td>-0.122816</td>
<td>0.693345</td>
<td>2.512555e-08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">speechiness</td>
<td>-0.164882</td>
<td>0.356519</td>
<td>0.470527</td>
<td>-0.159030</td>
<td>0.122572</td>
<td>-0.231263</td>
<td>-0.113832</td>
<td>-0.195934</td>
<td>-0.451256</td>
<td>0.342349</td>
<td>0.397910</td>
<td>1.174216e-08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">tempo</td>
<td>-0.247246</td>
<td>-0.032713</td>
<td>-0.205444</td>
<td>0.158888</td>
<td>0.459133</td>
<td>-0.571742</td>
<td>-0.317057</td>
<td>0.223821</td>
<td>-0.221113</td>
<td>-0.288377</td>
<td>-0.223564</td>
<td>-8.562726e-09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">valence</td>
<td>-0.432923</td>
<td>0.176206</td>
<td>-0.064601</td>
<td>-0.004597</td>
<td>-0.181024</td>
<td>-0.099021</td>
<td>-0.468560</td>
<td>-0.067845</td>
<td>0.589186</td>
<td>0.391578</td>
<td>-0.100676</td>
<td>-2.421501e-08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sadness</td>
<td>0.029325</td>
<td>-0.503645</td>
<td>0.338576</td>
<td>-0.371437</td>
<td>-0.180604</td>
<td>-0.083098</td>
<td>-0.246487</td>
<td>0.201408</td>
<td>-0.040182</td>
<td>-0.014708</td>
<td>-0.082324</td>
<td>-5.860299e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">joy</td>
<td>-0.074055</td>
<td>0.400435</td>
<td>-0.554874</td>
<td>-0.306828</td>
<td>0.056751</td>
<td>0.068051</td>
<td>0.136655</td>
<td>-0.154038</td>
<td>-0.099726</td>
<td>-0.018589</td>
<td>0.032253</td>
<td>-6.087316e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">love</td>
<td>0.107100</td>
<td>0.005575</td>
<td>0.147944</td>
<td>0.178263</td>
<td>0.702311</td>
<td>0.496282</td>
<td>-0.225293</td>
<td>0.116611</td>
<td>0.211828</td>
<td>0.070765</td>
<td>0.180095</td>
<td>-2.205194e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">anger</td>
<td>0.192255</td>
<td>0.288664</td>
<td>0.354063</td>
<td>0.237633</td>
<td>0.039010</td>
<td>-0.443503</td>
<td>0.403239</td>
<td>0.054367</td>
<td>0.461177</td>
<td>-0.147253</td>
<td>0.019369</td>
<td>-3.152212e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fear</td>
<td>-0.151217</td>
<td>-0.117818</td>
<td>-0.014168</td>
<td>0.779859</td>
<td>-0.253008</td>
<td>0.097645</td>
<td>-0.042092</td>
<td>-0.195516</td>
<td>-0.287340</td>
<td>0.136712</td>
<td>-0.045777</td>
<td>-3.714501e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">surprise</td>
<td>-0.022961</td>
<td>0.430670</td>
<td>0.056360</td>
<td>0.081186</td>
<td>-0.278405</td>
<td>0.200308</td>
<td>-0.077765</td>
<td>0.808438</td>
<td>-0.161244</td>
<td>-0.005079</td>
<td>-0.030064</td>
<td>-6.814124e-03</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
</section>
</section>
<section id="spotify-songs---similarity-search" class="level2">
<h2 class="anchored" data-anchor-id="spotify-songs---similarity-search">Spotify Songs - Similarity Search</h2>
<p>Below, we create a query to retrieve similar elements based on Euclidean distance. In mathematics, the Euclidean distance between two points is the length of the line segment between the two points. In this sense, the closer the distance is to 0, the more similar the songs are.</p>
<section id="knn-algorithm" class="level4">
<h4 class="anchored" data-anchor-id="knn-algorithm"><a href="https://www.kaggle.com/code/leomauro/spotify-songs-similarity-search/notebook">KNN Algorithm</a></h4>
<p>The k-Nearest Neighbors (KNN) algorithm searches for k similar elements based on a query point at the center within a predefined radius.</p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a song string search</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getMusicName(elem):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>elem[<span class="st">'artist'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>elem[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> knnQuery(queryPoint, arrCharactPoints, k):</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    queryVals <span class="op">=</span> queryPoint.tolist()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    distVals <span class="op">=</span> []</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Copy of dataframe indices and data</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> arrCharactPoints.copy(deep <span class="op">=</span> <span class="va">True</span>)  </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> tmp.iterrows():</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        feat <span class="op">=</span> row.values.tolist()</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate sum of squared differences</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        ssd <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">abs</span>(feat[i] <span class="op">-</span> queryVals[i]) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(queryVals)))</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get euclidean distance</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        distVals.append(ssd <span class="op">**</span> <span class="fl">0.5</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="st">'distance'</span>] <span class="op">=</span> distVals</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> tmp.sort_values(<span class="st">'distance'</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># K closest and furthest points</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tmp.head(k).index, tmp.tail(k).index</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute KNN removing the query point</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> querySimilars(df, columns, idx, func, param):</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> df[columns].copy(deep <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    queryPoint <span class="op">=</span> arr.loc[idx]</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> arr.drop([idx])</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> func(queryPoint, arr, param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>KNN Query Example.</strong></p>
<p>Our function allows us to create personalized query points and modify the columns to explore other options. For example, the following code selects a specific set of song attributes and then searches for the <span class="math inline">\(k\)</span> highest values of these attributes set equal to one.</p>
<p>Let’s search for <span class="math inline">\(k=3\)</span> similar songs to a query point <span class="math inline">\(\textrm{songIndex} = 6\)</span>.</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>scaler<span class="op">=</span>preprocessing.MinMaxScaler() <span class="co">#instantiate a scaler</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># all the feature values are in the range [0,1] ,except of loudnes</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># so let's scale it to fit the exact same range</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>loudness2 <span class="op">=</span> df[<span class="st">"loudness"</span>].values</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>loudness_scaled<span class="op">=</span>scaler.fit_transform(loudness2.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'loudness_scaled'</span>] <span class="op">=</span> loudness_scaled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select song and column attributes</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>songIndex <span class="op">=</span> <span class="dv">4</span> <span class="co"># query point</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">'acousticness'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'instrumentalness'</span>, <span class="st">'liveness'</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">'loudness_scaled'</span>, <span class="st">'tempo'</span>, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">'speechiness'</span>, <span class="st">'valence'</span>]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set query parameters</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>func, param <span class="op">=</span> knnQuery,<span class="dv">3</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement query</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> querySimilars(df, columns, songIndex, func, param)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---- Query Point ----"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(getMusicName(df.loc[songIndex]))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'---- k = 3 similar songs ----'</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> track_id <span class="kw">in</span> response[<span class="dv">0</span>]:</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    track_name <span class="op">=</span> getMusicName(df.loc[track_id])</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(track_name)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'---- k = 3 nonsimilar songs ----'</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> track_id <span class="kw">in</span> response[<span class="dv">1</span>]:</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    track_name <span class="op">=</span> getMusicName(df.loc[track_id])</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(track_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---- Query Point ----
Dua Lipa - Dance The Night (From Barbie The Album)
---- k = 3 similar songs ----
Dominic Fike - Mona Lisa (Spider-Man: Across the Spider-Verse)
Ed Sheeran - Eyes Closed
Rema - Calm Down (with Selena Gomez)
---- k = 3 nonsimilar songs ----
Doechii - What It Is (Solo Version)
Harry Styles - As It Was
Morgan Wallen - Last Night</code></pre>
</div>
</div>
<p>The code below implements the same idea as above, but queries each track in a given playlist instead of a single defined query point.</p>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>similar_count <span class="op">=</span> {} <span class="co"># Similar songs count</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>nonsimilar_count <span class="op">=</span> {} <span class="co"># Non-similar songs count</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> track_index <span class="kw">in</span> df.index:</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Implement query</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> querySimilars(df, columns, track_index, func, param)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get similar songs</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> similar_index <span class="kw">in</span> response[<span class="dv">0</span>]:</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        track <span class="op">=</span> getMusicName(df.loc[similar_index])</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> track <span class="kw">in</span> similar_count:</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            similar_count[track] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>            similar_count[track] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get non-similar songs</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> nonsimilar_index <span class="kw">in</span> response[<span class="dv">1</span>]:</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>        track <span class="op">=</span> getMusicName(df.loc[nonsimilar_index])</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> track <span class="kw">in</span> nonsimilar_count:</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>            nonsimilar_count[track] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>            nonsimilar_count[track] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>nonsimilar <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">sorted</span>(nonsimilar_count.items(), key<span class="op">=</span><span class="kw">lambda</span> item: item[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'---- NON SIMILAR SONG COUNTS ----'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> track_name, track_count <span class="kw">in</span> nonsimilar.items():</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> track_count <span class="op">&gt;=</span> <span class="dv">8</span>:</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(track_name, <span class="st">':'</span>, track_count)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>similar <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">sorted</span>(similar_count.items(), key<span class="op">=</span><span class="kw">lambda</span> item: item[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">---- SIMILAR SONG COUNTS ----'</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> track_name, track_count <span class="kw">in</span> similar.items():</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> track_count <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(track_name, <span class="st">':'</span>, track_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---- NON SIMILAR SONG COUNTS ----
Morgan Wallen - Last Night : 43
The Weeknd - Die For You - Remix : 31
Billie Eilish - What Was I Made For? [From The Motion Picture "Barbie"] : 26
Harry Styles - As It Was : 24
Doechii - What It Is (Solo Version) : 19

---- SIMILAR SONG COUNTS ----
SZA - Kill Bill : 5
OneRepublic - I Ain't Worried : 5
Quevedo - Columbia : 5
Nicki Minaj - Barbie World (with Aqua) [From Barbie The Album] : 5
Sam Smith - Unholy (feat. Kim Petras) : 5
Gunna - fukumean : 5
The Weeknd - Popular (with Playboi Carti &amp; Madonna) - Music from the HBO Original Series : 5</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="organized-songs-in-a-playlist" class="level2">
<h2 class="anchored" data-anchor-id="organized-songs-in-a-playlist">Organized Songs in a Playlist</h2>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> cluster, decomposition</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>songs <span class="op">=</span> df[[<span class="st">'name'</span>,<span class="st">'acousticness'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'instrumentalness'</span>, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'liveness'</span>, <span class="st">'speechiness'</span>, <span class="st">'tempo'</span>, <span class="st">'valence'</span>,  <span class="st">'loudness_scaled'</span>]]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>songs.describe()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">acousticness</th>
<th data-quarto-table-cell-role="th">danceability</th>
<th data-quarto-table-cell-role="th">energy</th>
<th data-quarto-table-cell-role="th">instrumentalness</th>
<th data-quarto-table-cell-role="th">liveness</th>
<th data-quarto-table-cell-role="th">speechiness</th>
<th data-quarto-table-cell-role="th">tempo</th>
<th data-quarto-table-cell-role="th">valence</th>
<th data-quarto-table-cell-role="th">loudness_scaled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
<td>50.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.262214</td>
<td>0.669240</td>
<td>0.659022</td>
<td>0.025725</td>
<td>0.177190</td>
<td>0.076142</td>
<td>125.244800</td>
<td>0.511538</td>
<td>0.784102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.244049</td>
<td>0.114132</td>
<td>0.165292</td>
<td>0.096359</td>
<td>0.122158</td>
<td>0.067282</td>
<td>27.035927</td>
<td>0.246883</td>
<td>0.162872</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.001260</td>
<td>0.444000</td>
<td>0.091100</td>
<td>0.000000</td>
<td>0.032200</td>
<td>0.025400</td>
<td>66.900000</td>
<td>0.096900</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.065750</td>
<td>0.563500</td>
<td>0.555000</td>
<td>0.000000</td>
<td>0.097025</td>
<td>0.035225</td>
<td>102.642250</td>
<td>0.304500</td>
<td>0.704982</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.174500</td>
<td>0.671000</td>
<td>0.679500</td>
<td>0.000008</td>
<td>0.115000</td>
<td>0.049200</td>
<td>127.992000</td>
<td>0.508500</td>
<td>0.823084</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.430500</td>
<td>0.759000</td>
<td>0.787250</td>
<td>0.000162</td>
<td>0.244250</td>
<td>0.081850</td>
<td>140.853000</td>
<td>0.730500</td>
<td>0.872186</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>0.959000</td>
<td>0.916000</td>
<td>0.965000</td>
<td>0.629000</td>
<td>0.563000</td>
<td>0.327000</td>
<td>203.853000</td>
<td>0.964000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> songs.values[:,<span class="dv">0</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> songs.values[:,<span class="dv">1</span>:<span class="dv">10</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> cluster.AffinityPropagation(preference<span class="op">=-</span><span class="dv">200</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>kmeans.fit(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>AffinityPropagation(preference=-200)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> {}</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p,n <span class="kw">in</span> <span class="bu">zip</span>(kmeans.predict(X),labels):</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> predictions.get(p):</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        predictions[p] <span class="op">=</span> []</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    predictions[p] <span class="op">+=</span> [n]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> predictions:</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Category"</span>,p)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-----"</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> predictions[p]:</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(n)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Category 0
-----
What Was I Made For? [From The Motion Picture "Barbie"]
Kill Bill
Attention
LALA
Karma

Category 4
-----
vampire
WHERE SHE GOES
Barbie World (with Aqua) [From Barbie The Album]
Super Shy
Calling (Spider-Man: Across the Spider-Verse) (Metro Boomin &amp; Swae Lee, NAV, feat. A Boogie Wit da Hoodie)
All My Life (feat. J. Cole)
Moonlight
Snooze
I Ain't Worried
Ella Baila Sola
Nonsense
Miracle (with Ellie Goulding)
Sprinter

Category 5
-----
Cruel Summer
As It Was
Chemical
What It Is (Solo Version)

Category 3
-----
Popular (with Playboi Carti &amp; Madonna) - Music from the HBO Original Series
Columbia
Creepin' (with The Weeknd &amp; 21 Savage)
Fast Car
Until I Found You (with Em Beihold) - Em Beihold Version
golden hour
Say Yes To Heaven

Category 6
-----
Dance The Night (From Barbie The Album)
Flowers
Calm Down (with Selena Gomez)
Eyes Closed
CUFF IT
Mona Lisa (Spider-Man: Across the Spider-Verse)

Category 2
-----
fukumean
Seven (feat. Latto) (Explicit Ver.)
Cupid - Twin Ver.
People
Baby Don't Hurt Me
Boy's a Liar Pt. 2
Daylight
MOJABI GHOST
Rush
I'm Good (Blue)
Here With Me
(It Goes Like) Nanana - Edit
Unholy (feat. Kim Petras)

Category 1
-----
Die For You - Remix

Category 7
-----
Last Night
</code></pre>
</div>
</div>
<hr>
<section id="k-means-clustering" class="level4">
<h4 class="anchored" data-anchor-id="k-means-clustering">K Means Clustering</h4>
<p>Using K Means clustering, I will be choosing to <a href="https://github.com/ankushbharadwaj/reorganize-my-spotify-playlist/blob/master/reorder%20my%20spotify%20playlist.ipynb">break my playlist into 3 smaller playlists</a>.</p>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>playlist_tracks <span class="op">=</span> df[[<span class="st">'artist'</span>,<span class="st">'name'</span>,<span class="st">'acousticness'</span>,<span class="st">'danceability'</span>,<span class="st">'energy'</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'liveness'</span>, <span class="st">'instrumentalness'</span>,<span class="st">'speechiness'</span>,<span class="st">'valence'</span>]]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>kmeans.fit(playlist_tracks.drop([<span class="st">'artist'</span>, <span class="st">'name'</span>], axis <span class="op">=</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>KMeans(n_clusters=3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span>[<span class="bu">str</span>(group) <span class="cf">for</span> group <span class="kw">in</span> kmeans.labels_], color <span class="op">=</span> <span class="st">'lightblue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>&lt;AxesSubplot:ylabel='count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-50-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="visualizing-the-clusters" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-the-clusters">Visualizing the Clusters</h4>
<p>Moving forward, let’s look at differences in the audio features of each group.</p>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>scaler.fit(playlist_tracks.drop([<span class="st">'artist'</span>, <span class="st">'name'</span>], axis <span class="op">=</span> <span class="dv">1</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> scaler.transform(playlist_tracks.drop([<span class="st">'artist'</span>, <span class="st">'name'</span>], axis <span class="op">=</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components <span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>pca.fit(scaled_data)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>data_pca <span class="op">=</span> pca.transform(scaled_data)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(data_pca[:,<span class="dv">0</span>], data_pca[:,<span class="dv">1</span>], c <span class="op">=</span> <span class="bu">list</span>(kmeans.labels_), cmap <span class="op">=</span> <span class="st">'Paired'</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PC1: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(pca.explained_variance_ratio_[<span class="dv">0</span>]), size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC2: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(pca.explained_variance_ratio_[<span class="dv">1</span>]), size <span class="op">=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>Text(0, 0.5, 'PC2: 0.206')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-52-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> sns.scatterplot(x<span class="op">=</span>data_pca[:,<span class="dv">0</span>], y<span class="op">=</span>data_pca[:,<span class="dv">1</span>], hue <span class="op">=</span> <span class="bu">list</span>(kmeans.labels_),</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                       alpha <span class="op">=</span> <span class="fl">0.66</span>, </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#size = data_pca[:,1], sizes = (50,200),</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                       palette <span class="op">=</span> <span class="st">'viridis'</span>, edgecolor <span class="op">=</span> <span class="st">'black'</span>, cmap<span class="op">=</span><span class="st">'Paired'</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>plot.set_title(<span class="st">'PCA ANALYSIS'</span>, size <span class="op">=</span> <span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PC1: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(pca.explained_variance_ratio_[<span class="dv">0</span>]), size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC2: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(pca.explained_variance_ratio_[<span class="dv">1</span>]), size <span class="op">=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>Text(0, 0.5, 'PC2: 0.206')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-53-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>playlist_tracks[<span class="st">'group'</span>] <span class="op">=</span> <span class="bu">list</span>(kmeans.labels_)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>playlist_tracks <span class="op">=</span> playlist_tracks.astype({<span class="st">'group'</span>: <span class="bu">str</span>})</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> pd.DataFrame(index <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">3</span>), </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                    columns <span class="op">=</span> <span class="bu">list</span>(playlist_tracks[playlist_tracks[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'0'</span>].describe().loc[<span class="st">'mean'</span>].index))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>means.iloc[<span class="dv">0</span>] <span class="op">=</span> playlist_tracks[playlist_tracks[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'0'</span>].describe().loc[<span class="st">'mean'</span>]</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>means.iloc[<span class="dv">1</span>] <span class="op">=</span> playlist_tracks[playlist_tracks[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'1'</span>].describe().loc[<span class="st">'mean'</span>]</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>means.iloc[<span class="dv">2</span>] <span class="op">=</span> playlist_tracks[playlist_tracks[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'2'</span>].describe().loc[<span class="st">'mean'</span>]</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\Hannah Luebbering\.conda\envs\cse160\lib\site-packages\ipykernel_launcher.py:1: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="103">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">acousticness</th>
<th data-quarto-table-cell-role="th">danceability</th>
<th data-quarto-table-cell-role="th">energy</th>
<th data-quarto-table-cell-role="th">liveness</th>
<th data-quarto-table-cell-role="th">instrumentalness</th>
<th data-quarto-table-cell-role="th">speechiness</th>
<th data-quarto-table-cell-role="th">valence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.211471</td>
<td>0.738905</td>
<td>0.710381</td>
<td>0.182595</td>
<td>0.009162</td>
<td>0.089543</td>
<td>0.760476</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.121411</td>
<td>0.654211</td>
<td>0.700368</td>
<td>0.194463</td>
<td>0.044511</td>
<td>0.079705</td>
<td>0.346205</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.6363</td>
<td>0.5515</td>
<td>0.47261</td>
<td>0.13302</td>
<td>0.024815</td>
<td>0.04123</td>
<td>0.3029</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>