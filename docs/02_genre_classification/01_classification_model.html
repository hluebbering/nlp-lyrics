<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>NLP Song Lyrics - Genre Classification Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../01_sentiment_analysis/02_nlp.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../assets/css/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../02_genre_classification/01_classification_model.html"><span class="chapter-title">Genre Classification Model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">NLP Song Lyrics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_sentiment_analysis/01_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Extracting Spotify Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_sentiment_analysis/02_nlp.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Natural Language Processing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_genre_classification/01_classification_model.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Genre Classification Model</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#step-1-data-collection" id="toc-step-1-data-collection" class="nav-link active" data-scroll-target="#step-1-data-collection">Step 1: Data Collection</a></li>
  <li><a href="#step-2-data-preprocessing" id="toc-step-2-data-preprocessing" class="nav-link" data-scroll-target="#step-2-data-preprocessing">Step 2: Data Preprocessing</a></li>
  <li><a href="#step-3.-feature-engineering" id="toc-step-3.-feature-engineering" class="nav-link" data-scroll-target="#step-3.-feature-engineering">Step 3. Feature Engineering</a></li>
  <li><a href="#step-4-model-selection-and-training" id="toc-step-4-model-selection-and-training" class="nav-link" data-scroll-target="#step-4-model-selection-and-training">Step 4: Model Selection and Training</a></li>
  <li><a href="#step-6-model-evaluation" id="toc-step-6-model-evaluation" class="nav-link" data-scroll-target="#step-6-model-evaluation">Step 6: Model Evaluation</a></li>
  <li><a href="#step-7-model-deployment" id="toc-step-7-model-deployment" class="nav-link" data-scroll-target="#step-7-model-deployment">Step 7: Model Deployment</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Genre Classification Model</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Objective.</strong> Construct a classification model that can accurately predict the genre of a song using a dataset containing Spotify track information, including artist details and genres. The model will utilize the audio features and potentially the lyrics of each track to make its predictions. Additionally, it will be trained using the artist genre list as well as a separate dataset of tracks that have been labeled with their respective genres.</p>
<p>Constructing a classification model to predict the genre of a song involves several steps, including data preprocessing, feature engineering, model selection, training, and evaluation. Here’s a step-by-step guide to achieve this:</p>
<div id="cell-2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>genres_v2[<span class="st">'genre'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>acoustic    110
pop         109
emo         108
happy       108
sad         107
punk        107
romance     106
grunge      106
hip-hop     105
chill       105
dance       103
piano       103
indie       102
rock        101
edm          77
techno       59
r-n-b        58
Name: genre, dtype: int64</code></pre>
</div>
</div>
<section id="step-1-data-collection" class="level3">
<h3 class="anchored" data-anchor-id="step-1-data-collection">Step 1: Data Collection</h3>
<p>Gather the necessary datasets: - <strong>Spotify API</strong>: Use the Spotify API to collect track information, including audio features (e.g., danceability, energy, key, loudness, mode, speechiness, acousticness, instrumentalness, liveness, valence, tempo). - <strong>Artist Genre Data</strong>: Gather genres associated with each artist from Spotify’s API. - <strong>Lyrics Data</strong>: Includes the lyrics of the tracks (optional but can enhance the model’s performance). - <strong>Genre Labels</strong>: Obtain a labeled dataset of tracks with their respective genres for training.</p>
<p>We want to try and predict a song’s genre based off of these audio features. Spotify provides a “genre seed:” an array of genres associated with the song used for the recommendation function of the API. We use the API to search for the top 1000 songs in a given genre, pull the audio features for each song, and add on the genre label.</p>
<div id="cell-4" class="cell" data-tags="[&quot;hide-code&quot;]" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">popularity</th>
<th data-quarto-table-cell-role="th">acousticness</th>
<th data-quarto-table-cell-role="th">danceability</th>
<th data-quarto-table-cell-role="th">energy</th>
<th data-quarto-table-cell-role="th">instrumentalness</th>
<th data-quarto-table-cell-role="th">liveness</th>
<th data-quarto-table-cell-role="th">loudness</th>
<th data-quarto-table-cell-role="th">speechiness</th>
<th data-quarto-table-cell-role="th">tempo</th>
<th data-quarto-table-cell-role="th">valence</th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">mode</th>
<th data-quarto-table-cell-role="th">time_signature</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
<td>1674.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>27.680406</td>
<td>0.228153</td>
<td>0.557579</td>
<td>0.654587</td>
<td>0.113044</td>
<td>0.188549</td>
<td>-7.521858</td>
<td>0.079652</td>
<td>122.751480</td>
<td>0.441805</td>
<td>5.263441</td>
<td>0.648148</td>
<td>3.931302</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>27.194546</td>
<td>0.312398</td>
<td>0.167096</td>
<td>0.244701</td>
<td>0.263844</td>
<td>0.152054</td>
<td>4.460943</td>
<td>0.081385</td>
<td>28.238078</td>
<td>0.232465</td>
<td>3.607028</td>
<td>0.477691</td>
<td>0.381192</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000002</td>
<td>0.062100</td>
<td>0.001500</td>
<td>0.000000</td>
<td>0.021500</td>
<td>-41.446000</td>
<td>0.022600</td>
<td>42.646000</td>
<td>0.027500</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.000000</td>
<td>0.005390</td>
<td>0.444000</td>
<td>0.489000</td>
<td>0.000000</td>
<td>0.095725</td>
<td>-9.013000</td>
<td>0.035425</td>
<td>100.149750</td>
<td>0.256250</td>
<td>2.000000</td>
<td>0.000000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>26.000000</td>
<td>0.056100</td>
<td>0.555000</td>
<td>0.707500</td>
<td>0.000046</td>
<td>0.126000</td>
<td>-6.326000</td>
<td>0.048200</td>
<td>123.467500</td>
<td>0.417000</td>
<td>6.000000</td>
<td>1.000000</td>
<td>4.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>53.000000</td>
<td>0.357750</td>
<td>0.676000</td>
<td>0.855000</td>
<td>0.012950</td>
<td>0.230750</td>
<td>-4.653750</td>
<td>0.084075</td>
<td>140.063750</td>
<td>0.613750</td>
<td>8.000000</td>
<td>1.000000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>83.000000</td>
<td>0.995000</td>
<td>0.969000</td>
<td>0.996000</td>
<td>0.978000</td>
<td>0.988000</td>
<td>-1.264000</td>
<td>0.578000</td>
<td>214.008000</td>
<td>0.980000</td>
<td>11.000000</td>
<td>1.000000</td>
<td>5.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<hr>
</section>
<section id="step-2-data-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="step-2-data-preprocessing">Step 2: Data Preprocessing</h3>
<p>Clean and preprocess the data to prepare it for model training. - <strong>Handle Missing Values</strong>: Remove or impute missing data. - <strong>Normalize/Standardize Features</strong>: Normalize or standardize the audio features to ensure they are on a similar scale. - <strong>Text Preprocessing for Lyrics</strong>: Tokenize, remove stopwords, and potentially use techniques like TF-IDF or word embeddings for the lyrics.</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize audio features</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define audio features</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>audio_features <span class="op">=</span> [<span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'key'</span>, <span class="st">'loudness'</span>, <span class="st">'speechiness'</span>, <span class="st">'acousticness'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'instrumentalness'</span>, <span class="st">'liveness'</span>, <span class="st">'valence'</span>, <span class="st">'tempo'</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform audio features</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>df[audio_features] <span class="op">=</span> scaler.fit_transform(df[audio_features])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="step-3.-feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="step-3.-feature-engineering">Step 3. Feature Engineering</h3>
<p>Create features from the available data. - <strong>Audio Features</strong>: Use the provided audio features. - <strong>Artist Genre Encoding</strong>: Encode categorical features (i.e.&nbsp;genres) using one-hot encoding or other suitable methods. - <strong>Lyrics Features</strong>: Convert lyrics into numerical features using techniques like TF-IDF, Word2Vec, or BERT embeddings. - Extract additional features from lyrics (e.g., sentiment analysis, topic modeling).</p>
<section id="label-encoder" class="level4">
<h4 class="anchored" data-anchor-id="label-encoder">Label Encoder</h4>
<div id="cell-11" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()  <span class="co"># Encode the target variable</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'genre_encoded'</span>] <span class="op">=</span> le.fit_transform(df[<span class="st">'genre'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine and arrange the data to create a final dataset for training the model.</p>
<div id="cell-13" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'key'</span>, <span class="st">'loudness'</span>, <span class="st">'speechiness'</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acousticness'</span>, <span class="st">'instrumentalness'</span>, <span class="st">'liveness'</span>, <span class="st">'valence'</span>, <span class="st">'tempo'</span>]]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[[<span class="st">'genre_encoded'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="step-4-model-selection-and-training" class="level3">
<h3 class="anchored" data-anchor-id="step-4-model-selection-and-training">Step 4: Model Selection and Training</h3>
<p>Choose an appropriate classification algorithm and train the model. - <strong>Algorithms</strong>: Consider using algorithms like Random Forest, Gradient Boosting, Support Vector Machine (SVM), or Neural Networks. - <strong>Cross-Validation</strong>: Use cross-validation to tune hyperparameters and avoid overfitting.</p>
<section id="model-training" class="level4">
<h4 class="anchored" data-anchor-id="model-training">Model Training</h4>
<p>The following code divides a dataset into training and testing subsets. It divides the input variables and target variables into 80% training and 20% testing groups at random. The descriptive statistics of the training data are then outputted to aid in data exploration and the identification of possible problems.</p>
<div id="cell-16" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, random_state<span class="op">=</span><span class="dv">42</span>) <span class="co"># test_size=0.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-fitting" class="level4">
<h4 class="anchored" data-anchor-id="model-fitting">Model Fitting</h4>
<div id="cell-18" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, GradientBoostingClassifier</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score, roc_auc_score</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prettytable <span class="im">import</span> PrettyTable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define models</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Logistic Regression"</span>: LogisticRegression(max_iter<span class="op">=</span><span class="dv">1000</span>, C<span class="op">=</span><span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Random Forest"</span>: RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, max_depth<span class="op">=</span><span class="dv">7</span>, min_samples_split<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SVM"</span>: SVC(probability<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Neural Network"</span>: MLPClassifier(hidden_layer_sizes<span class="op">=</span>(<span class="dv">100</span>,), max_iter<span class="op">=</span><span class="dv">500</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KNN"</span>: KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Decision Tree"</span>: DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">7</span>, min_samples_split<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gradient Boost"</span>: GradientBoostingClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, learning_rate<span class="op">=</span><span class="fl">0.05</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XGB"</span>: XGBClassifier(n_estimators<span class="op">=</span><span class="dv">300</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="step-6-model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="step-6-model-evaluation">Step 6: Model Evaluation</h3>
<p>Evaluate the model’s performance using appropriate metrics. - <strong>Metrics</strong>: Use accuracy, precision, recall, F1-score, and confusion matrix to assess the model. - <strong>Validation Set</strong>: Use a separate validation set to test the model’s generalization ability.</p>
<p>We can evaluate the performance of different models using multiple criteria: Accuracy, ROC-AUC, Precision, Recall, and F1-Score. Based on the provided metrics, let’s analyze the performance of each model to determine which one is the best:</p>
<div id="cell-22" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store the results</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models and evaluate</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train, y_train)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    y_prob <span class="op">=</span> model.predict_proba(X_test) <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"predict_proba"</span>) <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    report <span class="op">=</span> classification_report(y_test, y_pred, output_dict<span class="op">=</span><span class="va">True</span>, zero_division<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    results.append({</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>: name, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Accuracy"</span>: accuracy_score(y_test, y_pred), </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ROC-AUC"</span>: roc_auc_score(y_test, y_prob, multi_class<span class="op">=</span><span class="st">'ovr'</span>) <span class="cf">if</span> y_prob <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Precision"</span>: report[<span class="st">'weighted avg'</span>][<span class="st">'precision'</span>], </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Recall"</span>: report[<span class="st">'weighted avg'</span>][<span class="st">'recall'</span>], </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"F1-Score"</span>: report[<span class="st">'weighted avg'</span>][<span class="st">'f1-score'</span>]</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-tags="[&quot;hide-code&quot;]" data-execution_count="11">
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<style type="text/css">
#T_e7d7e td.col0 {
  font-family: "Roboto";
  color: #e83e8c;
  font-size: 13px;
  font-weight: 800;
  text-transform: uppercase;
}
#T_e7d7e td {
  font-family: "Roboto";
  color: black;
  font-size: 12px;
  font-weight: 400;
}
#T_e7d7e_row1_col1, #T_e7d7e_row1_col2, #T_e7d7e_row1_col3, #T_e7d7e_row1_col4, #T_e7d7e_row6_col5 {
  color: white !important;
  background-color: #d23d75;
  font-weight: 700 !important;
  font-size: 13px !important;
}
</style>

<table id="T_e7d7e" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_e7d7e_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Model</th>
<th id="T_e7d7e_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Accuracy</th>
<th id="T_e7d7e_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">ROC-AUC</th>
<th id="T_e7d7e_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Precision</th>
<th id="T_e7d7e_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Recall</th>
<th id="T_e7d7e_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">F1-Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_e7d7e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_e7d7e_row0_col0" class="data row0 col0">Logistic Regression</td>
<td id="T_e7d7e_row0_col1" class="data row0 col1">0.291169</td>
<td id="T_e7d7e_row0_col2" class="data row0 col2">0.812339</td>
<td id="T_e7d7e_row0_col3" class="data row0 col3">0.286944</td>
<td id="T_e7d7e_row0_col4" class="data row0 col4">0.291169</td>
<td id="T_e7d7e_row0_col5" class="data row0 col5">0.272028</td>
</tr>
<tr class="even">
<td id="T_e7d7e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_e7d7e_row1_col0" class="data row1 col0">Random Forest</td>
<td id="T_e7d7e_row1_col1" class="data row1 col1">0.329356</td>
<td id="T_e7d7e_row1_col2" class="data row1 col2">0.832776</td>
<td id="T_e7d7e_row1_col3" class="data row1 col3">0.335009</td>
<td id="T_e7d7e_row1_col4" class="data row1 col4">0.329356</td>
<td id="T_e7d7e_row1_col5" class="data row1 col5">0.305644</td>
</tr>
<tr class="odd">
<td id="T_e7d7e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_e7d7e_row2_col0" class="data row2 col0">SVM</td>
<td id="T_e7d7e_row2_col1" class="data row2 col1">0.298329</td>
<td id="T_e7d7e_row2_col2" class="data row2 col2">0.816533</td>
<td id="T_e7d7e_row2_col3" class="data row2 col3">0.287245</td>
<td id="T_e7d7e_row2_col4" class="data row2 col4">0.298329</td>
<td id="T_e7d7e_row2_col5" class="data row2 col5">0.278114</td>
</tr>
<tr class="even">
<td id="T_e7d7e_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</td>
<td id="T_e7d7e_row3_col0" class="data row3 col0">Neural Network</td>
<td id="T_e7d7e_row3_col1" class="data row3 col1">0.288783</td>
<td id="T_e7d7e_row3_col2" class="data row3 col2">0.803341</td>
<td id="T_e7d7e_row3_col3" class="data row3 col3">0.282435</td>
<td id="T_e7d7e_row3_col4" class="data row3 col4">0.288783</td>
<td id="T_e7d7e_row3_col5" class="data row3 col5">0.281682</td>
</tr>
<tr class="odd">
<td id="T_e7d7e_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</td>
<td id="T_e7d7e_row4_col0" class="data row4 col0">KNN</td>
<td id="T_e7d7e_row4_col1" class="data row4 col1">0.233890</td>
<td id="T_e7d7e_row4_col2" class="data row4 col2">0.669295</td>
<td id="T_e7d7e_row4_col3" class="data row4 col3">0.226509</td>
<td id="T_e7d7e_row4_col4" class="data row4 col4">0.233890</td>
<td id="T_e7d7e_row4_col5" class="data row4 col5">0.222153</td>
</tr>
<tr class="even">
<td id="T_e7d7e_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">5</td>
<td id="T_e7d7e_row5_col0" class="data row5 col0">Decision Tree</td>
<td id="T_e7d7e_row5_col1" class="data row5 col1">0.272076</td>
<td id="T_e7d7e_row5_col2" class="data row5 col2">0.739925</td>
<td id="T_e7d7e_row5_col3" class="data row5 col3">0.271790</td>
<td id="T_e7d7e_row5_col4" class="data row5 col4">0.272076</td>
<td id="T_e7d7e_row5_col5" class="data row5 col5">0.250733</td>
</tr>
<tr class="odd">
<td id="T_e7d7e_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">6</td>
<td id="T_e7d7e_row6_col0" class="data row6 col0">Gradient Boost</td>
<td id="T_e7d7e_row6_col1" class="data row6 col1">0.315036</td>
<td id="T_e7d7e_row6_col2" class="data row6 col2">0.814781</td>
<td id="T_e7d7e_row6_col3" class="data row6 col3">0.328956</td>
<td id="T_e7d7e_row6_col4" class="data row6 col4">0.315036</td>
<td id="T_e7d7e_row6_col5" class="data row6 col5">0.313637</td>
</tr>
<tr class="even">
<td id="T_e7d7e_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">7</td>
<td id="T_e7d7e_row7_col0" class="data row7 col0">XGB</td>
<td id="T_e7d7e_row7_col1" class="data row7 col1">0.286396</td>
<td id="T_e7d7e_row7_col2" class="data row7 col2">0.781179</td>
<td id="T_e7d7e_row7_col3" class="data row7 col3">0.289853</td>
<td id="T_e7d7e_row7_col4" class="data row7 col4">0.286396</td>
<td id="T_e7d7e_row7_col5" class="data row7 col5">0.285033</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="conclusion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion">Conclusion</h4>
<p>Considering all metrics, <strong>Random Forest</strong> appears to be the best model overall due to its high performance across multiple metrics (accuracy and ROC-AUC), while the <strong>Neural Network</strong> also performs well with the highest precision and F1-Score.</p>
<p>These results suggest that the Random Forest, Neural Network, and SVM models are the most effective for this specific task of predicting the genre of a song using the given dataset.</p>
<!--
Considering these metrics, the **Gradient Boosting** model is the best performing model overall. It has the highest accuracy, precision, recall, and F1-score, making it the most balanced model in terms of performance across different evaluation metrics.-->
<hr>
</section>
</section>
<section id="step-7-model-deployment" class="level3">
<h3 class="anchored" data-anchor-id="step-7-model-deployment">Step 7: Model Deployment</h3>
<p>Deploy the model for practical use. - <strong>Save the Model</strong>: Save the trained model using libraries like joblib or pickle. - <strong>API Creation</strong>: Create an API using Flask or FastAPI to make predictions on new data.</p>
<div id="cell-27" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the Random Forest model</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>random_forest_model <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, max_depth<span class="op">=</span><span class="dv">7</span>, min_samples_split<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>random_forest_model.fit(X_train, y_train)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Save scaler + model for future use</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>joblib.dump(scaler, <span class="st">'scaler.pkl'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>joblib.dump(random_forest_model, <span class="st">'random_forest_model.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>['random_forest_model.pkl']</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> random_forest_model.predict(X_test)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy:"</span>, accuracy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 0.32935560859188545</code></pre>
</div>
</div>
<section id="applying-model-to-new-data" class="level4">
<h4 class="anchored" data-anchor-id="applying-model-to-new-data">Applying Model to New Data</h4>
<div id="cell-30" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the trained models + scaler</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>random_forest_model <span class="op">=</span> joblib.load(<span class="st">'random_forest_model.pkl'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> joblib.load(<span class="st">'scaler.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load new data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> pd.read_csv(<span class="st">"../assets/data/all_tracks+lyrics.csv"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract relevant columns</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> df_new[[<span class="st">'name'</span>, <span class="st">'danceability'</span>, <span class="st">'energy'</span>, <span class="st">'key'</span>, <span class="st">'loudness'</span>, <span class="st">'speechiness'</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'acousticness'</span>, <span class="st">'instrumentalness'</span>, <span class="st">'liveness'</span>, <span class="st">'valence'</span>, <span class="st">'tempo'</span>]]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess new data</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>X_new_data <span class="op">=</span> new_data.drop(columns<span class="op">=</span>[<span class="st">'name'</span>])</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>X_new_data_scaled <span class="op">=</span> scaler.transform(X_new_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-32" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> random_forest_model.predict(X_new_data_scaled)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>probabilities <span class="op">=</span> random_forest_model.predict_proba(X_new_data_scaled)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Decode the predicted genre labels</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>predictions_label <span class="op">=</span> le.inverse_transform(predictions)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display predictions</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>new_data[<span class="st">'Predicted Genre'</span>] <span class="op">=</span> predictions</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>new_data[<span class="st">'Predicted Genre Label'</span>] <span class="op">=</span> predictions_label</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>new_data[<span class="st">'Prediction Probabilities'</span>] <span class="op">=</span> probabilities.tolist()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>new_data[[<span class="st">'name'</span>, <span class="st">'Predicted Genre Label'</span>, <span class="st">'Predicted Genre'</span>, <span class="st">'Prediction Probabilities'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">Predicted Genre Label</th>
<th data-quarto-table-cell-role="th">Predicted Genre</th>
<th data-quarto-table-cell-role="th">Prediction Probabilities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Espresso</td>
<td>pop</td>
<td>10</td>
<td>[0.04832254153187096, 0.12619269101055017, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BIRDS OF A FEATHER</td>
<td>indie</td>
<td>8</td>
<td>[0.062251132860993375, 0.1350221101568469, 0.1...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>I Had Some Help (Feat. Morgan Wallen)</td>
<td>happy</td>
<td>6</td>
<td>[0.029337791261863377, 0.07129928471933508, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Too Sweet</td>
<td>happy</td>
<td>6</td>
<td>[0.03110784942385244, 0.07207603026340323, 0.1...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MILLION DOLLAR BABY</td>
<td>pop</td>
<td>10</td>
<td>[0.021188299219084113, 0.06175288340078473, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>we can't be friends (wait for your love)</td>
<td>pop</td>
<td>10</td>
<td>[0.06131610996839342, 0.09285144407448995, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>A Bar Song (Tipsy)</td>
<td>pop</td>
<td>10</td>
<td>[0.06472761794832327, 0.1272680424393216, 0.02...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>LUNCH</td>
<td>dance</td>
<td>2</td>
<td>[0.057410671030815943, 0.07659489738600524, 0....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Fortnight (feat. Post Malone)</td>
<td>sad</td>
<td>15</td>
<td>[0.1634002656168661, 0.13524188930269576, 0.00...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Beautiful Things</td>
<td>romance</td>
<td>14</td>
<td>[0.06134736364973052, 0.08543240103706232, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>i like the way you kiss me</td>
<td>rock</td>
<td>13</td>
<td>[0.007352859917424355, 0.0186163664804808, 0.1...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Please Please Please</td>
<td>pop</td>
<td>10</td>
<td>[0.05484400855863455, 0.09565418558487603, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>End of Beginning</td>
<td>dance</td>
<td>2</td>
<td>[0.09961923753210948, 0.0904829832820782, 0.11...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Houdini</td>
<td>happy</td>
<td>6</td>
<td>[0.010771952741578305, 0.07198130147963207, 0....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Lose Control</td>
<td>romance</td>
<td>14</td>
<td>[0.053126154256947646, 0.12564655171183095, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Not Like Us</td>
<td>hip-hop</td>
<td>7</td>
<td>[0.031892615385277774, 0.07170660657451432, 0....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Good Luck, Babe!</td>
<td>pop</td>
<td>10</td>
<td>[0.07813084208166093, 0.09704788505899932, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>I Can Do It With a Broken Heart</td>
<td>pop</td>
<td>10</td>
<td>[0.04922753425420418, 0.08735245470843163, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Belong Together</td>
<td>pop</td>
<td>10</td>
<td>[0.11179875786263554, 0.12087464660186649, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Saturn</td>
<td>acoustic</td>
<td>0</td>
<td>[0.14686346634076933, 0.10380959997550107, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Slow It Down</td>
<td>happy</td>
<td>6</td>
<td>[0.05372462763732637, 0.07412152089580584, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Austin</td>
<td>pop</td>
<td>10</td>
<td>[0.0501664673717607, 0.0933994660596392, 0.052...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>Stargazing</td>
<td>pop</td>
<td>10</td>
<td>[0.0700828327026069, 0.1180781676318351, 0.036...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>Pink Skies</td>
<td>chill</td>
<td>1</td>
<td>[0.09012108560090301, 0.15018375147564447, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>Stick Season</td>
<td>acoustic</td>
<td>0</td>
<td>[0.18591473045968132, 0.08382765471124884, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>greedy</td>
<td>happy</td>
<td>6</td>
<td>[0.06177391429539499, 0.0887022100914361, 0.02...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Scared To Start</td>
<td>chill</td>
<td>1</td>
<td>[0.13107766291528747, 0.14041067548070166, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>Nasty</td>
<td>hip-hop</td>
<td>7</td>
<td>[0.05112198969699953, 0.09815715992186375, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>Water</td>
<td>pop</td>
<td>10</td>
<td>[0.036958899774743065, 0.09166638627468936, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Gata Only</td>
<td>hip-hop</td>
<td>7</td>
<td>[0.07944251331085496, 0.10507118676058398, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>Miles On It</td>
<td>happy</td>
<td>6</td>
<td>[0.030293084752480434, 0.060393964528687914, 0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>yes, and?</td>
<td>pop</td>
<td>10</td>
<td>[0.03923640328030741, 0.10172945800400378, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>TEXAS HOLD 'EM</td>
<td>pop</td>
<td>10</td>
<td>[0.06947162655502154, 0.09576348368506085, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>BAND4BAND (feat. Lil Baby)</td>
<td>hip-hop</td>
<td>7</td>
<td>[0.010963028586862973, 0.07859730857102712, 0....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>Feel It - From The Original Series “Invincible”</td>
<td>pop</td>
<td>10</td>
<td>[0.04719639945364053, 0.07947306411719812, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>One Of The Girls (with JENNIE, Lily Rose Depp)</td>
<td>romance</td>
<td>14</td>
<td>[0.04780153582857584, 0.08538916614307925, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Tell Ur Girlfriend</td>
<td>hip-hop</td>
<td>7</td>
<td>[0.005698984522066412, 0.04019258793156138, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>Lovin On Me</td>
<td>happy</td>
<td>6</td>
<td>[0.0239466418597217, 0.07187688521272997, 0.07...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>Santa</td>
<td>pop</td>
<td>10</td>
<td>[0.036950640543466605, 0.09902254261629856, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>CHIHIRO</td>
<td>piano</td>
<td>9</td>
<td>[0.06865514957748471, 0.08885887995987213, 0.1...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Whatever</td>
<td>pop</td>
<td>10</td>
<td>[0.04481988407189988, 0.09728907499399733, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>Illusion</td>
<td>pop</td>
<td>10</td>
<td>[0.03406716211351513, 0.08771688922697399, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>I Don't Wanna Wait</td>
<td>pop</td>
<td>10</td>
<td>[0.04502505120855936, 0.09875116742062903, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>Jump</td>
<td>pop</td>
<td>10</td>
<td>[0.02580044873861146, 0.10764863778519679, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>I Remember Everything (feat. Kacey Musgraves)</td>
<td>acoustic</td>
<td>0</td>
<td>[0.18922332829839963, 0.12607182575835746, 0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>one of wun</td>
<td>hip-hop</td>
<td>7</td>
<td>[0.003697849395802203, 0.04443929940707556, 0....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>obsessed</td>
<td>pop</td>
<td>10</td>
<td>[0.039187875030013225, 0.09090484970317311, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>Magnetic</td>
<td>pop</td>
<td>10</td>
<td>[0.03485985300807636, 0.07644729855332005, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>redrum</td>
<td>dance</td>
<td>2</td>
<td>[0.03290810189070711, 0.06273202050019706, 0.1...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<hr>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../01_sentiment_analysis/02_nlp.html" class="pagination-link" aria-label="Natural Language Processing">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Natural Language Processing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>